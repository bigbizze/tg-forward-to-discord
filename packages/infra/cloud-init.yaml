#cloud-config

package_update: true
package_upgrade: true
packages:
  - curl
  - git
  - build-essential
  - python3
  - python3-pip
  - python3-venv
  - sqlite3
  - unattended-upgrades

runcmd:
  - 'curl -fsSL https://deb.nodesource.com/setup_22.x | bash -'
  - 'apt-get install -y nodejs'
  - 'npm install -g pnpm@9.0.0'
  - 'npm install -g pm2'
  - 'pm2 startup systemd -u root --hp /root'
  - 'systemctl enable pm2-root'
  - 'mkdir -p /opt/tg-discord'
  - 'chown root:root /opt/tg-discord'
  - 'timedatectl set-timezone UTC'
  - 'dpkg-reconfigure -plow unattended-upgrades'

# Remove write_files section - don't create any files in /opt/tg-discord

power_state:
  mode: reboot
  timeout: 300
  condition: true